<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>School Chess</title>

  <link rel="stylesheet"
        href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

  <style>
    body {
      background: #111;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    h1 { margin: 20px 0; }
    #board { width: 512px; }

    /* Brown board */
    .white-1e1d7 { background-color: #f0d9b5 !important; }
    .black-3c85d { background-color: #b58863 !important; }

    /* Legal move highlights */
    .white-1e1d7.highlight-legal { background-color: #20a3ca !important; }
    .black-3c85d.highlight-legal { background-color: #178db1 !important; }

    /* Kill all outlines / borders */
    .square-55d63,
    .square-55d63:hover,
    .square-55d63:focus {
      outline: none !important;
      box-shadow: none !important;
    }
  </style>

</head>
<body>

<h1>School Chess</h1>
<div id="board"></div>

<script>
  const game = new Chess();
  let board;
  let selected = null;

  const PIECES = {
    wK:"https://lichess1.org/assets/hashed/wK.bc7274dd.svg",
    wQ:"https://lichess1.org/assets/hashed/wQ.79c9227e.svg",
    wR:"https://lichess1.org/assets/hashed/wR.e9e95adc.svg",
    wB:"https://lichess1.org/assets/hashed/wB.b7d1a118.svg",
    wN:"https://lichess1.org/assets/hashed/wN.68b788d7.svg",
    wP:"https://lichess1.org/assets/hashed/wP.0596b7ce.svg",
    bK:"https://lichess1.org/assets/hashed/bK.c5f22c23.svg",
    bQ:"https://lichess1.org/assets/hashed/bQ.5abdb5aa.svg",
    bR:"https://lichess1.org/assets/hashed/bR.c33a3d54.svg",
    bB:"https://lichess1.org/assets/hashed/bB.77e9debf.svg",
    bN:"https://lichess1.org/assets/hashed/bN.d0665564.svg",
    bP:"https://lichess1.org/assets/hashed/bP.09539f32.svg",
  };

  function clearLegal() {
    $(".square-55d63").removeClass("highlight-legal");
  }

  function showLegal(square) {
    clearLegal();
    const moves = game.moves({ square, verbose:true });
    moves.forEach(m => $(`.square-${m.to}`).addClass("highlight-legal"));
  }

  /* ----------------------
     DRAG-TO-MOVE
  ----------------------- */
  function onDragStart(source, piece) {
    if (game.game_over()) return false;
    if (piece[0] !== game.turn()) return false;

    selected = source;
    showLegal(source);
    return true;
  }

  function onDrop(source, target) {
    const move = game.move({ from:source, to:target, promotion:"q" });
    clearLegal();

    if (!move) return "snapback";

    board.position(game.fen());
    selected = null;
  }

  function onSnapEnd() {
    board.position(game.fen());
  }

  /* ----------------------
     CLICK-TO-MOVE
  ----------------------- */
  $("#board").on("click", ".square-55d63", function () {
    const sq = $(this).data("square");
    const piece = game.get(sq);

    // Clicking same selected → deselect
    if (selected === sq) {
      selected = null;
      clearLegal();
      return;
    }

    // No selection yet → select a piece
    if (!selected) {
      if (!piece || piece.color !== game.turn()) return;
      selected = sq;
      showLegal(sq);
      return;
    }

    // Attempt a move
    const move = game.move({ from:selected, to:sq, promotion:"q" });
    clearLegal();

    if (move) {
      board.position(game.fen(), true); // animate click moves
      selected = null;
      return;
    }

    // Clicked another own piece → switch selection
    if (piece && piece.color === game.turn()) {
      selected = sq;
      showLegal(sq);
      return;
    }

    // Otherwise clear
    selected = null;
  });

  /* ----------------------
     INIT BOARD
  ----------------------- */
  board = Chessboard("board", {
    draggable:true,
    showNotation:false,
    position:"start",
    pieceTheme: piece => PIECES[piece],
    onDragStart,
    onDrop,
    onSnapEnd
  });
</script>

</body>
</html>
